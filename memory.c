#include <stdio.h>
#include <stdlib.h>
#include <string.h>
/* memory.c */
/* from Gray Hat Hacking Book, with my own additions */

void memory() {
    char * str;
    char instrBuffer[100];
    str = (char*) malloc (10 * sizeof (char));

    printf("Enter a string of length 10 or less: ");
    
    /*
     *  For my own reference:
     *  
     *  The gets function is dangerous for a similar reason
     *  to why strcpy is dangerous
     *  if the length of the string inputed
     *  extends past the allocated length in
     *  instrBuffer, this will result in a 
     *  buffer overflow.
     */

    // gets(instrBuffer);
    
    // it is safer to use fgets, which knows the size of the buffer
    fgets(instrBuffer, sizeof(instrBuffer), stdin);

    int i = 0;
    while(instrBuffer[i] != '\0') {
        if(i > 10) {
            printf("String is too large.");
            return;
        }
        i++;
    }

    strncpy(str, instrBuffer, 10);
    while(*str!='\0') {
        printf("%c", *str++);
    }
}
void main(int argc, char * argv[]) {
    memory();
}
